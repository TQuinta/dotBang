<%= render "shared/navbar" %>

<div class='page-container'>
  <div class='index-container'>
      <%= render "sidebar" %>
    <div class='right-container' id="select-margin">
      <div class = "index-middle-container" data-controller="select-category">
      <%= simple_fields_for :tag do |n| %>
        <%= n.input :tag,
                    as: :radio_buttons,
                    collection_wrapper_tag: 'div',
                    collection_wrapper_class: 'tag-wrapper',
                    item_wrapper_class: 'tag-item',
                    input_html: {class: 'tag-index', data: { action:"click->select-category#showDropdown" }},
                    collection: Post::CATEGORIES %>
        <div class="category-type-container <%= 'd-none' unless params[:type] == "Role" %>" data-select-category-target="roles">
          <% Role.all.each do |role| %>
            <%# postable_id could be anything as long as we use the same name in the controller  %>
            <%= link_to role.name, posts_path(type: "Role", postable_id: role.id), class: 'tag-index-roles', data: {action:"click->select-category#showSearch"}  %>

                    collection: Post::CATEGORIES,
                    checked: "#{params[:type]}s" # This is Lorenzo's fault and it is horrible I-ll fix it at some point
                     %>
        <% end %>

        <div class="category-type-container <%= 'd-none' unless params[:type] == "Role" %>" data-select-category-target="roles">
          <% Role.all.each do |role| %>
              <%= link_to role.name,
                posts_path(type: "Role", postable_id: role.id),
                class: "tag-index-roles #{ 'active' if role == @postable }",
                data: {action:"click->select-category#showSearch"}  %>
          <% end %>
        </div>

        <div class="category-type-container <%= 'd-none' unless params[:type] == "Skill" %>" data-select-category-target="skills">

          <% Skill.all.each do |skill| %>
            <%= link_to skill.name, posts_path(type: "Skill", postable_id: skill.id), class: 'tag-index-skills', data: {action:"click->select-category#showSearch"} %>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="index-results-container" data-select-category-target="results">
      <div class="row justify-content-center">
        <div class="col-sm-8">
          <% if @posts.empty? && params[:type].present? %>
            <div class="posts-title-index">
             <h1 id="results">Unfortunately, there are no posts at the moment üôÅ</h1>
            </div>
          <% elsif params[:type].present? %>
            <div class="posts-title-index">
              <h1 id="results">
              <% if @posts.size==1 %>
                <%= @posts.size%> &nbsp result
              <%else%>
                <%= @posts.size %> &nbsp results
              <%end%>
              </h1>
            </div>
            <% @posts.each do |post| %>
              <%= link_to post_path(post), class: "text-decoration-none"  do %>
                <div class="post-index">
                  <%= image_tag "https://uploads.sitepoint.com/wp-content/uploads/2017/03/1488480428eloquent-js.jpg",  class: "card-trip-user " %>

                  <div class="post-content-index">
                    <div class="post-text-index">
                      <h2> <%= post.title %> - <%= post.postable.name%> </h2>
                      <p><%= post.blurb %></p>
                    </div>
                    <div class ="post-details-index">
                      <div id="icons-top-right">
                        <div class="icon btn btn-primary">
                          <i class="far fa-bookmark"></i>
                        </div>

                        <div class="icon btn btn-primary">
                          <i class="fas fa-exclamation"></i>
                        </div>
                      </div>
                      <div class="post-author-index">
                        <% user = User.find(post.user_id)%>
                        <p><strong><%= user.first_name %> <%= user.last_name %></strong>,  <%= post.created_at.strftime("%Y-%m-%d")%></p>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
          
          <% Skill.all.each do |role| %>
              <%= link_to role.name,
                posts_path(type: "Skill", postable_id: role.id),
                class: "tag-index-skills #{ 'active' if role == @postable }",
                data: {action:"click->select-category#showSearch"} %>

          <% end %>
      </div>
    </div>
    <div class="container results-container" data-select-category-target="results">
      <div class="row justify-content-center">
        <div class="col-sm-8">

          <% if @posts.empty? && params[:type].present? %>
            <h1 id="no-chef">No posts at the moment üôÅ</h1>
          <% elsif params[:type].present? %>
            <div class="posts-title">
              <h1 id="results">Results</h1>
            </div>
            <% @posts.each do |post| %>
              <%= link_to post_path(post), class: "text-decoration-none"  do %>
                <div class="post">
                  <%# if post.chef_profile.meal_picture_url %>
                    <%#= image_tag booking.chef_profile.meal_picture_url%>
                  <%# else %>
                    <%#= cl_image_tag booking.chef_profile.photo.key, crop: :fill %>
                  <%# end %>
                  <%= image_tag "https://uploads.sitepoint.com/wp-content/uploads/2017/03/1488480428eloquent-js.jpg",  class: "card-trip-user " %>

                  <div class="post-content">
                    <div class="post-text">
                      <h2> <%= post.title %> - <%= post.postable.name%> </h2>
                      <p><%= post.blurb %></p>
                    </div>
                    <div class="author">
                      <% user = User.find(post.user_id)%>
                      <p><strong><%= user.first_name %> <%= user.last_name %></strong>,  <%= post.created_at.strftime("%Y-%m-%d")%></p>
                    </div>
                  </div>
                </div>
                <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
